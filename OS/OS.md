## 进程
程序段+数据段+PCB = 进程
PCB记录了操作系统所需的用于描述进程的当前情况以及控制进程运行的全部信息。PCB是进程存在的唯一标识。
PCB包括：进程标识符，处理机状态，进程调度信息，进程控制信息，处理机状态。

### 特性 
- 动态性：进程的本质就是进程实体的一次执行过程。由创建而产生，由调度而执行，由撤销而消亡。
- 并发性：重要特征
- 独立性：独立运行，独立分配资源，独立接受调度的基本单位
- 异步性：进程按各自独立的不可预知的速度向前推进，或者说进程实体按异步方式运行。

### 进程的状态
- 创建
- 就绪 所有资源已经准备就绪，等待CPU时间
- 运行 运行状态
- 阻塞 有CPU时间，但是需要等待某个或者某些资源的使用权
- 挂起 主动让出CPU时间，等待其他进程或者超时唤醒
- 退出

### 进程同步
遵循：空闲让进，忙则等待，有限等待，让权等待。
信号量
管程
管道
共享内存
消息队列
套接字

### 进程调度
- 先来先服务 FCFS
- 短作业优先
- 优先级
- 时间片轮转
- 多级反馈队列：设置多个就绪队列，并赋予不同的优先级，优先级最高的队列中，每个进程规定的时间片越小，第二个队列时间片比第一个长一倍，以此类推。当一个新的进程进入内存后，首先放入第一列的队尾，当轮到该进程执行时，若在时间片内完成，则可移出队列，否则调度程序将其放入第二优先级。仅仅当第一列空闲时，调度程序才调度第二队列中的进程运行。

## 进程和线程

### 线程和进程的区别，还有就是什么时候用线程，什么时候用进程

- 进程的管理和控制信息都放在进程控制模块PCB(Process Control Block),
- 线程的生命周期
	新生（new born）--就绪(runnable)--运行(running)--阻塞(blocked)--运行(running)--死亡(dead)
- 进程是指运行中的应用程序，每一个进程都有自己独立的内存空间。一个应用程序可以同时启动多个进程。
	例如对于IE浏览器程序，每打开一个IE浏览器窗口，就启动了一个新的进程。同样，每次执行JDK的java.exe程序，就启动了一个独立的Java虚拟机进程，该进程的任务是解析并执行Java程序代码。(启动两个tomcat,会有2个java虚拟机进程)
	线程是指进程中的一个执行流程，有时也称为执行情景。一个进程可以由多个线程组成，即在一个进程中可以同时运行多个不同的线程，它们分别执行不同的任务。当进程内的多个线程同时运行时，这种运行方式称为并发运行。
	许多服务器程序，如数据库服务器和Web服务器，都支持并发运行，这些服务器能同时响应来自不同客户的请求。
	进程和线程的主要区别在于：每个进程都需要操作系统为其分配独立的内存地址空间，而同一进程中的所有线程在同一块地址空间中工作，这些线程可以共享同一块内存和系统资源，比如共享一个对象或者共享已经打开的一个文件。

### 下面，我们从调度、并发性、系统开销、拥有资源等方面，来比较线程与进程

- 调度
	在传统的操作系统中，拥有资源的基本单位和独立调度、分派的基本单位都是进程。而在引入线程的操作系统中，则把线程作为调度和分派的基本单位。而把进程作为资源拥有的基本单位，使传统进程的两个属性分开，线程便能轻装运行，从而可显著地提高系统的并发程度。
	在同一进程中，线程的切换不会引起进程的切换，在由一个进程中的线程切换到另一个进程中的线程时，将会引起进程的切换。
- 并发性
	在引入线程的操作系统中，不仅进程之间可以并发执行，而且在一个进程中的多个线程之间，亦可并发执行，因而使操作系统具有更好的并发性，从而能更有效地使用系统资源和提高系统吞吐量。
	例如，在一个未引入线程的单CPU操作系统中，若仅设置一个文件服务进程，当它由于某种原因而被阻塞时，便没有其它的文件服务进程来提供服务。在引入了线程的操作系统中，可以在一个文件服务进程中，设置多个服务线程，当第一个线程等待时，文件服务进程中的第二个线程可以继续运行；当第二个线程阻塞时，第三个线程可以继续执行，从而显著地提高了文件服务的质量以及系统吞吐量。
- 拥有资源
	不论是传统的操作系统，还是设有线程的操作系统，进程都是拥有资源的一个独立单位，它可以拥有自己的资源。一般地说，线程自己不拥有系统资源(也有一点必不可少的资源，主要是程序计数器、一组寄存器和栈)，但它可以访问其隶属进程的资源。亦即，一个进程的代码段、数据段以及系统资源，如已打开的文件、I/O设备等，可供问一进程的其它所有线程共享。
- 系统开销
	由于在创建或撤消进程时，系统都要为之分配或回收资源，如内存空间、I／o设备等。因此，操作系统所付出的开销将显著地大于在创建或撤消线程时的开销。类似地，在进行进程切换时，涉及到整个当前进程CPU环境的保存以及新被调度运行的进程的CPU环境的设置。
	而线程切换只须保存和设置少量寄存器的内容，并不涉及存储器管理方面的操作。
	可见，进程切换的开销也远大于线程切换的开销。此外，由于同一进程中的多个线程具有相同的地址空间，致使它们之间的同步和通信的实现，也变得比较容易。

### 根据进程与线程的设置，操作系统大致分为如下类型： 

- 单进程、单线程，MS-DOS大致是这种操作系统；
- 多进程、单线程，多数UNIX(及类UNIX的LINUX)是这种操作系统；
- 多进程、多线程，Win32(Windows NT/2000/XP等)、Solaris 2.x和OS/2都是这种操作系统；
- 单进程、多线程，VxWorks是这种操作系统。

###进程间通信的几种主要手段简介：

- 管道（Pipe）及有名管道（named pipe）：管道可用于具有亲缘关系进程间的通信，有名管道克服了管道没有名字的限制，因此，除具有管道所具有的功能外，它还允许无亲缘关系进程间的通信； 
- 信号（Signal）：信号是比较复杂的通信方式，用于通知接受进程有某种事件发生，除了用于进程间通信外，进程还可以发送信号给进程本身；linux除了支持Unix早期信号语义函数sigal外，还支持语义符合Posix.1标准的信号函数sigaction（实际上，该函数是基于BSD的，BSD为了实现可靠信号机制，又能够统一对外接口，用sigaction函数重新实现了signal函数）； 
- 报文（Message）队列（消息队列）：消息队列是消息的链接表，包括Posix消息队列system V消息队列。有足够权限的进程可以向队列中添加消息，被赋予读权限的进程则可以读走队列中的消息。消息队列克服了信号承载信息量少，管道只能承载无格式字节流以及缓冲区大小受限等缺点。 
- 共享内存：使得多个进程可以访问同一块内存空间，是最快的可用IPC形式。是针对其他通信机制运行效率较低而设计的。往往与其它通信机制，如信号量结合使用，来达到进程间的同步及互斥。 
- 信号量（semaphore）：主要作为进程间以及同一进程不同线程之间的同步手段。 
- 套接口（Socket）：更为一般的进程间通信机制，可用于不同机器之间的进程间通信。起初是由Unix系统的BSD分支开发出来的，但现在一般可以移植到其它类Unix系统上：Linux和System V的变种都支持套接字。

## 内存管理
[推荐链接](http://www.cnblogs.com/CareySon/archive/2012/04/25/2470063.html)
### 虚拟内存
是指计算机呈现出要比实际拥有的内存大得多的内存量。每个进程有用独立的逻辑地址空间，内存被分为大小相等的多个块,称为页(Page).每个页都是一段连续的地址。对于进程来看,逻辑上貌似有很多内存空间，其中一部分对应物理内存上的一块(称为页框，通常页和页框大小相等)，还有一些没加载在内存中的对应在硬盘上
### 内存分配
#### 连续分配
- 首次适应：分配时从空闲分区链首顺序查找，直到找到一个大小能满足要求的空闲分区为止，从中划出请求大小的内存，如果不能，此次分配失败。
- 循环首次适应：首次适应基础上改变而来，每次不是从链首查找而是从上次找到的空闲分区的下一个空闲分区开始查找。
- 最佳适应：是指每次把既能满足要求又是最小的空闲分区给作业，缺点会留下难以利用的小空间。
- 最坏适应：挑选一个最大的空闲分区给作业，缺点使存储器缺乏大的存储空间。
- 快速适应：是指将空闲分区根据容量大小分类，对每一类具有相同容量的所有空闲分区，单独设置一张空闲分区链表，内存中在设立一张索引表。该算法的优点是查找效率高，不易产生内存碎片，但空闲分区划分的越细，浪费越严重，这是一种以空间换时间的做法。

#### 离散分配
分页管理
分段管理 优点：方便编程，信息保护，信息共享，动态增长，动态链接
区别：
- 分页是操作系统为了方便内存管理的行为，而段是信息的逻辑单位，分段是为了满足用户的需要。
- 一个操作系统中页的大小是固定，而段的大小不确定。
- 分页空间地址是一维的，分段是二维的，寻址时既需要给出段号，也需要给出段地址。

### 磁盘调度
- FCFS，先来先服务算法
- SSTF，最短寻道时间优先 要求访问的磁道离当前磁头最近。
- SCAN扫描算法：欲访问的磁道离当前磁道最近，同时考虑方向。要求访问的磁道离当前磁头最近，且在磁道之外，直到没有更外的磁道才向里移动。又称电梯算法。
- CSCAN：循环扫描。当前进程请求某一磁道，进程等待。CSCAN规定磁头只能单向移动。到达最外磁道后，立即返回最内磁道。即将最小磁道紧接最大磁道构成循环。


## 文件管理
### 顺序文件
物理记录按照其在文件中的逻辑顺序依次存入磁盘中建立的。即文件中的物理顺序和逻辑顺序是一致的。
从本质上讲，顺序文件就是线性表，因而对顺序文件的各种操作与线性表类似，但是，外存的访问速度比主存要慢的多，在考虑算法时要立足于尽量减少外存的访问次数，寻道次数和寻道时间。

### 索引文件
建立了一张逻辑记录和物理记录之间对应关系的索引表。
索引表由若干索引项组成，一般索引项由关键字所在记录的物理地址组成。

### Hash文件
哈希（Hash）文件又称散列文件或者直接存取文件，是利用哈希函数映射的文件，它类似于哈希表，即根据文件记录的关键字的特点，设计一种哈希函数和处理冲突的方法，从而将记录散列到外存储器上。由于哈希文件中通过计算来确定一个记录在存储设备上的存储位置，因而逻辑顺序的记录在物理地址上是不相邻的，因此哈希文件不宜使用磁带存储，只适宜使用磁盘存储；并且哈希文件这种结构只适用于定长记录文件和按主键随机查找的访问方式。

### 多重表文件
多重表文件是一种将索引方法和链接方法相结合的组织方式，他对主关键字建立主索引，对每个需要查询的次关键字均建立一个索引，同时将具有相同次关键字的记录链接成一个链表，并将此链表的头指针、链表长度及次关键字，作为索引表的一个索引项

### 倒排文件
倒排文件和多重表文件构造相似，主要区别在于在次关键字索引中，具有相同次关键字的记录之间不设指针进行链接，而是在倒排表中列出具有该次关键字记录的所有物理记录号。 倒排文件中的次关键字索引称做倒排表。倒排表和主文件一起就构成了倒排文件。

## 死锁
### 定义
在两个或多个并发进程中，如果每个进程持有某种资源而又都等待别的进程释放他或者他们现在保持着的资源，在未改变这种状态之前都不能向前推进，称这一组进程产生了死锁。通俗地讲，就是两个或多个进程被无限期的阻塞，相互等待的一种状态

### 产生的必要条件
- 互斥条件：一个资源一次只能被一个进程使用
- 请求保持条件： 一个进程因请求资源而阻塞时，对已经获得的资源保持不放
- 不可抢占条件：进程已获得的资源在未使用完毕之前不能被强行剥夺
- 循环等待条件：若干进程之间形成一种头尾相接的循环等待资源的关系

### 避免的方法
- 破坏请求和保持条件：规定所有进程在运行开始之前，都必须一次性的申请其在整个运行过程中所需要的所有资源。优点是简单安全，缺点是资源严重浪费
- 破坏不可抢占条件：进程逐个的提出资源请求，当一个已经保持了某些资源的进程，在提出新的资源而不能立即得到满足时必须释放他已经保持了的所有资源，待以后需要时再重新申请。缺点是实现复杂，反复的申请和释放资源，而使进程的执行无限推迟。
- 破坏环路等待条件：将所有的资源按照类型进行线性排队，并赋予不同的序列号，所有进程请求资源必须按照资源递增的次序提出，防止出现环路。缺点是限制了新设备类型的增加，使用资源顺序和系统规定的顺序不同而造成资源的浪费

### 监测和解除死锁
挂起或者撤销一些进程，将资源释放出来，分配给有阻塞的进程，使之转为就绪，继续运行。
解除死锁：剥夺资源，撤销进程。常见的做法是撤销所有死锁进程。

## 内存管理
### 程序地址重定位
对程序进行重定位的技术按重定位的时机可分为两种：
- 静态重定位
- 动态重定位。
静态重定位：是在目标程序装入内存时，由装入程序对目标程序中的指令和数据的地址进行修改，即把程序的逻辑地址都改成实际的地址。对每个程序来说，这种地址变换只是在装入时一次完成，在程序运行期间不再进行重定位。 
优点：是无需增加硬件地址转换机构，便于实现程序的静态连接。在早期计算机系统中大多采用这种方案。 
缺点：（1）程序的存储空间只能是连续的一片区域，而且在重定位之后就不能再移动。这不利于内存空间的有效使用。（2）各个用户进程很难共享内存中的同一程序的副本。 

动态重定位：是在程序执行期间每次访问内存之前进行重定位。这种变换是靠硬件地址变换机构实现的。通常采用一个重定位寄存器，其中放有当前正在执行的程序在内存空间中的起始地址，而地址空间中的代码在装入过程中不发生变化。 
优点：（1）程序占用的内存空间动态可变，不必连续存放在一处。（2）比较容易实现几个进程对同一程序副本的共享使用。 
缺点：是需要附加的硬件支持，增加了机器成本，而且实现存储管理的软件算法比较复杂。 
现在一般计算机系统中都采用动态重定位方法。

## Linux文件系统 
文件是指具有文件名的若干相关元素的集合。元素通常是记录，而记录是一组有意义的数据项的集合。文件系统的管理对象是文件，目录和磁盘存储空间。
Linux文件系统使用索引节点来记录文件信息。索引节点是一个保存文件的长度、创建及修改时间、权限、所属关系、磁盘中的位置等信息的结构。一个文件系统维护了一个索引节点的数组，每个文件和目录都和数组中的一个元素一一对应。每个索引节点也由操作系统分配了一个索引节点号，而索引节点号和文件名也保存在目录中。所以目录只是将索引节点号和他的文件名称联系起来的一张表，目录中每一对文件名称和索引节点号称为一个连接。对于一个文件来说有唯一的索引节点号与之对应，对于一个索引节点号，可以有多个文件名与之对应。因此，在磁盘上的同一个文件可以通过不同的路径去访问。


### 杂项
1.批处理不能处理需要交互的作业。

2.linux提供了一种机制可以保证只要父进程想知道子进程结束时的状态信息， 就可以得到。这种机制就是: 在每个进程退出的时候,内核释放该进程所有的资源,包括打开的文件,占用的内存等。 但是仍然为其保留一定的信息(包括进程号the process ID,退出状态the termination status of the process,运行时间the amount of CPU time taken by the process等)。直到父进程通过wait / waitpid来取时才释放。

2.孤儿进程：一个父进程退出，而它的一个或多个子进程还在运行，那么那些子进程将成为孤儿进程。孤儿进程将被init进程(进程号为1)所收养，并由init进程对它们完成状态收集工作。
僵尸进程：一个进程使用fork创建子进程，如果子进程退出，而父进程并没有调用wait或waitpid获取子进程的状态信息，那么子进程的进程描述符仍然保存在系统中。这种进程称之为僵死进程。

僵死进程并不是问题的根源，罪魁祸首是产生出大量僵死进程的那个父进程，所以，解决方法就是kill那个父进程，于是僵尸进程就可以被init进程接收，释放。


3.分时操作系统  (time-sharing system)，“分时”的含义：分时是指多个用户分享使用同一台计算机。多个程序分时共享硬件和软件资源。 分时操作系统 是指在一台 主机 上连接多个带有显示器和键盘的 终端 ，同时允许多个用户通过主机的终端，以交互方式使用计算机，共享主机中的资源。 分时操作系统 是一个多用户交互式操作系统。 分时操作系统 ，主要分为三类：单道分时操作系统，多道分时操作系统，具有前台和后台的分时操作系统。



